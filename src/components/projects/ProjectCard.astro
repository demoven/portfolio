---
// Component for displaying a single project card
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { getLogoByName } from "../../utils/techLogos";

interface Props {
    project: CollectionEntry<"projects">;
    index: number;
}

const { project, index } = Astro.props;

// Import all project images
const allProjectImages = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/projects/**/*.{png,jpg,jpeg,webp,gif}",
    { eager: true },
);

// Get the image for this project
const imagePath = project.data.image.startsWith("/")
    ? project.data.image
    : `/${project.data.image}`;
const projectImage = allProjectImages[imagePath]?.default;

// Only load eagerly for the first 4 projects (above the fold)
const loadingStrategy = index < 3 ? "eager" : "lazy";
---

<a
    href={`/projects/${project.id}`}
    class="block group rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 bg-white border border-zinc-100"
>
    <div class="relative overflow-hidden">
        {
            projectImage && (
                <Image
                    src={projectImage}
                    alt={project.data.title}
                    loading={loadingStrategy}
                    width={600}
                    height={400}
                    class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
                />
            )
        }
        <div
            class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"
        >
        </div>
        <span
            class="absolute bottom-3 left-3 px-3 py-1 bg-zinc-900 text-white text-xs font-bold rounded-full opacity-90"
        >
            {
                new Date(project.data.date).toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "short",
                })
            }
        </span>
    </div>

    <div class="p-6">
        <h2
            class="text-xl font-bold text-zinc-900 mb-4 group-hover:text-indigo-600 transition-colors"
        >
            {project.data.title}
        </h2>

        <div class="flex flex-wrap gap-3">
            {
                project.data.technologies.map((tech: string) => {
                    const logo = getLogoByName(tech);
                    return (
                        <div
                            class="flex items-center justify-center p-1.5 rounded-lg bg-zinc-50 border border-zinc-100 shadow-sm"
                            title={tech}
                        >
                            {logo ? (
                                <Image
                                    src={logo}
                                    alt={tech}
                                    class="w-5 h-5 object-contain"
                                    loading={loadingStrategy}
                                />
                            ) : (
                                <span class="text-[10px] font-bold text-zinc-400">
                                    {tech}
                                </span>
                            )}
                        </div>
                    );
                })
            }
        </div>
    </div>
</a>
